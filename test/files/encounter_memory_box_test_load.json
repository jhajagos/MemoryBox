{
  "data_connection": 
  {
      "name": "ehr_warehouse",
      "data_connection_type": "SQLite"
  },
  "name": "encounter",
  "items": {
    "classes": [
      {"name": "discharges",
       "transitions":
        [
          {
            "from": null,
            "to": "New",
            "query_template": "discharge_query",
            "action": "Insert new",
            "parameters": {},
            "defaults": {},
            "actions": [
              {"name": "Insert",
               "data_item_class": "encounter_detail"
              }
            ]
          }
        ],
        "data_items": {
          "classes": [
            {"name": "encounter_detail",
              "data_type": "JSON",
              "actions": [
                {
                  "name": "Insert",
                  "query_template": "encounter_detail_query",
                  "parameters": {}
                }
              ]
            },
            {"name": "encounter_dx",
              "data_type": "JSON",
              "actions": [
                {
                  "name": "Insert",
                  "query_template": "encounter_dx_query",
                  "parameters": {}
                }
              ]
            },
            {"name": "person",
              "data_type": "JSON",
              "actions": [
                {
                  "name": "Insert",
                  "query_template": "person_query",
                  "parameters": {}
                }
              ]
            },
            {"name": "encounter_document",
              "data_type": "Text",
              "actions": [
                {
                  "name": "Insert",
                  "query_template": "encounter_document_query",
                  "parameters": {}
                }
              ]
            }
          ]
        }
      }
    ]
  },
  "query_templates": [
    {
      "name": "discharge_query",
      "template": "select encounter_id as transaction_id from encounters where discharge_date is not null and discharge_date >= :lower_discharge_date and discharge_date < :upper_discharge_date",
      "parameter_list": ["lower_discharge_date", "upper_discharge_date"]
    },
    {
      "name": "encounter_detail_query",
      "template": "select * from encounters = :encounter_id",
      "parameter_list": ["encounter_id"]
    },
    {
      "name": "encounter_dx_query",
      "template": "select * from encounter_dx = :encounter_id order by sequence_id",
      "parameter_list": ["encounter_id"]
    },
    {
      "name": "encounter_document_query",
      "template": "select * from encounter_docuement = :encounter_id",
      "parameter_list": ["encounter_id"]
    },
    {
      "name": "person_query",
      "template": "select * from pseduo_mrn = :pseudo_mrn",
      "parameter_list": ["pseudo_mrn"]
    }
  ]
}
